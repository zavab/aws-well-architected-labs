



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A collection of AWS Well-Architected workshops">
      
      
        <link rel="canonical" href="https://wellarchitectedlabs.com/Reliability/300_Health_Checks_and_Dependencies/Lab_Guide.html">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Lab Guide - AWS Well-Architected Labs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#757575">
      
    
    
      <script src="../../assets/javascripts/modernizr.1f0bcf2b.js"></script>



    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="grey" data-md-color-accent="grey">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#level-300-implementing-health-checks-and-managing-dependencies-to-improve-reliability" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://wellarchitectedlabs.com" title="AWS Well-Architected Labs" class="md-header-nav__button md-logo">
          
            <img src="../../images/wa.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              AWS Well-Architected Labs
            </span>
            <span class="md-header-nav__topic">
              
                Lab Guide
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/awslabs/aws-well-architected-labs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    awslabs/aws-well-architected-labs
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../README.html" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Operations/README.html" class="md-tabs__link">
          Operational Excellence
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Security/README.html" class="md-tabs__link">
          Security
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../README.html" class="md-tabs__link md-tabs__link--active">
          Reliability
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Performance/README.html" class="md-tabs__link">
          Performance Efficiency
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Cost/README.html" class="md-tabs__link">
          Cost Optimization
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Well-ArchitectedTool/README.html" class="md-tabs__link">
          Well Architected Tool
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://wellarchitectedlabs.com" title="AWS Well-Architected Labs" class="md-nav__button md-logo">
      
        <img src="../../images/wa.png" width="48" height="48">
      
    </a>
    AWS Well-Architected Labs
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/awslabs/aws-well-architected-labs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    awslabs/aws-well-architected-labs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../README.html" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Operational Excellence
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Operational Excellence
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Operations/README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      100 Inventory Patch Mgt
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        100 Inventory Patch Mgt
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Operations/100_Inventory_and_Patch_Mgmt/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Operations/100_Inventory_and_Patch_Mgmt/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Security
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Security
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Security 100 Labs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Security 100 Labs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2-1" type="checkbox" id="nav-3-2-1">
    
    <label class="md-nav__link" for="nav-3-2-1">
      Account and Root User
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-2-1">
        Account and Root User
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/100_AWS_Account_and_Root_User/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/100_AWS_Account_and_Root_User/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2-2" type="checkbox" id="nav-3-2-2">
    
    <label class="md-nav__link" for="nav-3-2-2">
      Basic Identity & Access Management User, Group, Role
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-2-2">
        Basic Identity & Access Management User, Group, Role
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/100_Basic_Identity_and_Access_Management_User_Group_Role/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/100_Basic_Identity_and_Access_Management_User_Group_Role/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2-3" type="checkbox" id="nav-3-2-3">
    
    <label class="md-nav__link" for="nav-3-2-3">
      CloudFront with S3 Bucket Origin
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-2-3">
        CloudFront with S3 Bucket Origin
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/100_CloudFront_with_S3_Bucket_Origin/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/100_CloudFront_with_S3_Bucket_Origin/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2-4" type="checkbox" id="nav-3-2-4">
    
    <label class="md-nav__link" for="nav-3-2-4">
      Create a Data Bunker
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-2-4">
        Create a Data Bunker
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/100_Create_a_Data_Bunker/README.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2-5" type="checkbox" id="nav-3-2-5">
    
    <label class="md-nav__link" for="nav-3-2-5">
      Enable Security Hub
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-2-5">
        Enable Security Hub
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/100_Enable_Security_Hub/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/100_Enable_Security_Hub/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      Security 200 Labs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        Security 200 Labs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3-1" type="checkbox" id="nav-3-3-1">
    
    <label class="md-nav__link" for="nav-3-3-1">
      Automated Deployment of Detective Controls
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-1">
        Automated Deployment of Detective Controls
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/200_Automated_Deployment_of_Detective_Controls/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/200_Automated_Deployment_of_Detective_Controls/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3-2" type="checkbox" id="nav-3-3-2">
    
    <label class="md-nav__link" for="nav-3-3-2">
      Automated Deployment of EC2 Web Application
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-2">
        Automated Deployment of EC2 Web Application
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/200_Automated_Deployment_of_EC2_Web_Application/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/200_Automated_Deployment_of_EC2_Web_Application/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3-3" type="checkbox" id="nav-3-3-3">
    
    <label class="md-nav__link" for="nav-3-3-3">
      Automated Deployment of IAM Groups and Roles
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-3">
        Automated Deployment of IAM Groups and Roles
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/200_Automated_Deployment_of_IAM_Groups_and_Roles/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/200_Automated_Deployment_of_IAM_Groups_and_Roles/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3-4" type="checkbox" id="nav-3-3-4">
    
    <label class="md-nav__link" for="nav-3-3-4">
      Automated Deployment of VPC
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-4">
        Automated Deployment of VPC
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/200_Automated_Deployment_of_VPC/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/200_Automated_Deployment_of_VPC/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3-5" type="checkbox" id="nav-3-3-5">
    
    <label class="md-nav__link" for="nav-3-3-5">
      Automated Deployment of Web Application Firewall
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-5">
        Automated Deployment of Web Application Firewall
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/200_Automated_Deployment_of_Web_Application_Firewall/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/200_Automated_Deployment_of_Web_Application_Firewall/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3-6" type="checkbox" id="nav-3-3-6">
    
    <label class="md-nav__link" for="nav-3-3-6">
      Automated IAM User Cleanup
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-6">
        Automated IAM User Cleanup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/200_Automated_IAM_User_Cleanup/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/200_Automated_IAM_User_Cleanup/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3-7" type="checkbox" id="nav-3-3-7">
    
    <label class="md-nav__link" for="nav-3-3-7">
      Basic EC2 with WAF Protection
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-7">
        Basic EC2 with WAF Protection
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/200_Basic_EC2_with_WAF_Protection/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/200_Basic_EC2_with_WAF_Protection/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3-8" type="checkbox" id="nav-3-3-8">
    
    <label class="md-nav__link" for="nav-3-3-8">
      CloudFront with WAF Protection
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-8">
        CloudFront with WAF Protection
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/200_CloudFront_with_WAF_Protection/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/200_CloudFront_with_WAF_Protection/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      Security 300 Labs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        Security 300 Labs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4-1" type="checkbox" id="nav-3-4-1">
    
    <label class="md-nav__link" for="nav-3-4-1">
      IAM Permission Boundaries Delegating Role Creation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-4-1">
        IAM Permission Boundaries Delegating Role Creation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/300_IAM_Permission_Boundaries_Delegating_Role_Creation/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/300_IAM_Permission_Boundaries_Delegating_Role_Creation/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4-2" type="checkbox" id="nav-3-4-2">
    
    <label class="md-nav__link" for="nav-3-4-2">
      IAM Tag Based Access Control for EC2
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-4-2">
        IAM Tag Based Access Control for EC2
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/300_IAM_Tag_Based_Access_Control_for_EC2/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/300_IAM_Tag_Based_Access_Control_for_EC2/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4-3" type="checkbox" id="nav-3-4-3">
    
    <label class="md-nav__link" for="nav-3-4-3">
      Incident Response with AWS Console and CLI
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-4-3">
        Incident Response with AWS Console and CLI
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/300_Incident_Response_with_AWS_Console_and_CLI/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/300_Incident_Response_with_AWS_Console_and_CLI/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4-4" type="checkbox" id="nav-3-4-4">
    
    <label class="md-nav__link" for="nav-3-4-4">
      Lambda Cross Account IAM Role Assumption
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-4-4">
        Lambda Cross Account IAM Role Assumption
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/300_Lambda_Cross_Account_IAM_Role_Assumption/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/300_Lambda_Cross_Account_IAM_Role_Assumption/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4-5" type="checkbox" id="nav-3-4-5">
    
    <label class="md-nav__link" for="nav-3-4-5">
      Lambda Cross Account Using Bucket Policy
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-4-5">
        Lambda Cross Account Using Bucket Policy
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/300_Lambda_Cross_Account_Bucket_Policy/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/300_Lambda_Cross_Account_Bucket_Policy/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4-6" type="checkbox" id="nav-3-4-6">
    
    <label class="md-nav__link" for="nav-3-4-6">
      Incident Response Playbook with Jupyter
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-4-6">
        Incident Response Playbook with Jupyter
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/300_Incident_Response_Playbook_with_Jupyter-AWS_IAM/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/300_Incident_Response_Playbook_with_Jupyter-AWS_IAM/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-5" type="checkbox" id="nav-3-5">
    
    <label class="md-nav__link" for="nav-3-5">
      Security Quests
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-5">
        Security Quests
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/Quest_100_Loft_Introduction_to_Security/README.html" title="Introduction to Security" class="md-nav__link">
      Introduction to Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/Quest_100_Quick_Steps_to_Security_Success/README.html" title="Quick Steps to Security Success" class="md-nav__link">
      Quick Steps to Security Success
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/Quest_200_Incident_Response_Day/README.html" title="Incident Response Day" class="md-nav__link">
      Incident Response Day
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/Quest_300_Security_Best_Practices_Workshop_EC2/README.html" title="Security Best Practices Workshop" class="md-nav__link">
      Security Best Practices Workshop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/Quest_300_Security_Best_Practices_Day/README.html" title="Security Best Practices Day" class="md-nav__link">
      Security Best Practices Day
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/Quest_Managing_Credentials_and_Authentication/README.html" title="Managing Credentials and Authentication" class="md-nav__link">
      Managing Credentials and Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/Quest_Control_Human_Access/README.html" title="Control Human Access" class="md-nav__link">
      Control Human Access
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/Quest_Control_Programmatic_Access/README.html" title="Control Programmatic Access" class="md-nav__link">
      Control Programmatic Access
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/Quest_Detect_and_Investigate_Events/README.html" title="Detect and Investigate Events" class="md-nav__link">
      Detect and Investigate Events
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/Quest_Defend_Against_New_Threats/README.html" title="Defend Against New Threats" class="md-nav__link">
      Defend Against New Threats
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/Quest_Protect_Networks/README.html" title="Protect Networks" class="md-nav__link">
      Protect Networks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/Quest_Protect_Compute/README.html" title="Protect Compute" class="md-nav__link">
      Protect Compute
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/Quest_Classify_Data/README.html" title="Classify Data" class="md-nav__link">
      Classify Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/Quest_Protect_Data_at_Rest/README.html" title="Protect Data at Rest" class="md-nav__link">
      Protect Data at Rest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/Quest_Protect_Data_in_Transit/README.html" title="Protect Data in Transit" class="md-nav__link">
      Protect Data in Transit
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Security/Quest_Incident_Response/README.html" title="Incident Response" class="md-nav__link">
      Incident Response
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Reliability
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Reliability
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      200 Testing Backup and Restore of Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        200 Testing Backup and Restore of Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../200_Testing_Backup_and_Restore_of_Data/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../200_Testing_Backup_and_Restore_of_Data/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3" checked>
    
    <label class="md-nav__link" for="nav-4-3">
      300 Health Checks and Dependencies
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        300 Health Checks and Dependencies
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Lab Guide
      </label>
    
    <a href="Lab_Guide.html" title="Lab Guide" class="md-nav__link md-nav__link--active">
      Lab Guide
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#author" class="md-nav__link">
    Author
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#amazon-builders-library-and-aws-well-architected" class="md-nav__link">
    Amazon Builders' Library and AWS Well-Architected
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    Table of Contents
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-deploy-the-application" class="md-nav__link">
    1. Deploy the application 
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-log-into-the-aws-console" class="md-nav__link">
    1.1 Log into the AWS console 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-deploy-the-application-using-an-aws-cloudformation-template" class="md-nav__link">
    1.2 Deploy the application using an AWS CloudFormation template
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121-deploy-the-vpc-infrastructure" class="md-nav__link">
    1.2.1 Deploy the VPC infrastructure
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#express-steps-deploy-the-vpc-infrastructure" class="md-nav__link">
    Express Steps (Deploy the VPC infrastructure)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122-deploy-the-web-app-infrastructure-and-service" class="md-nav__link">
    1.2.2 Deploy the web app infrastructure and service
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#express-steps-deploy-the-webapp-infrastructure-and-service" class="md-nav__link">
    Express Steps (Deploy the WebApp infrastructure and service)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-view-the-website-for-web-service" class="md-nav__link">
    1.3 View the website for web service 
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-handle-failure-of-service-dependencies" class="md-nav__link">
    2. Handle failure of service dependencies 
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-system-dependency-initially-healthy" class="md-nav__link">
    2.1 System dependency initially healthy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-simulate-dependency-not-available" class="md-nav__link">
    2.2 Simulate dependency not available
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221-disable-recommendationservice" class="md-nav__link">
    2.2.1 Disable RecommendationService
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-observe-behavior-when-dependency-not-available" class="md-nav__link">
    2.2.2 Observe behavior when dependency not available
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-update-server-code-to-handle-dependency-not-available" class="md-nav__link">
    2.3 Update server code to handle dependency not available
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#231-option-1-expert-option-make-and-deploy-your-changes-to-the-code" class="md-nav__link">
    2.3.1 Option 1 - Expert option: make and deploy your changes to the code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#232-option-2-assisted-option-deploy-workshop-provided-code" class="md-nav__link">
    2.3.2 Option 2 - Assisted option: deploy workshop provided code
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-the-new-error-handling-code" class="md-nav__link">
    Deploy the new error handling code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#233-error-handling-code" class="md-nav__link">
    2.3.3 Error handling code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#234-observe-behavior-of-web-service-with-added-error-handling" class="md-nav__link">
    2.3.4 Observe behavior of web service with added error handling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-implement-deep-health-checks" class="md-nav__link">
    3. Implement deep health checks 
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-re-enable-the-dependency-service" class="md-nav__link">
    3.1 Re-enable the dependency service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-inject-fault-on-a-single-server" class="md-nav__link">
    3.2 Inject fault on a single server 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-observe-application-behavior-and-determine-how-to-fix-it" class="md-nav__link">
    3.4 Observe application behavior and determine how to fix it
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-create-a-deep-healthcheck-to-identify-bad-servers" class="md-nav__link">
    3.4 Create a deep healthcheck to identify bad servers
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#341-option-1-expert-option-make-and-deploy-your-changes-to-the-code" class="md-nav__link">
    3.4.1 Option 1 - Expert option: make and deploy your changes to the code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#342-option-2-assisted-option-deploy-workshop-provided-code" class="md-nav__link">
    3.4.2 Option 2 - Assisted option: deploy workshop provided code
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-the-new-health-check-code" class="md-nav__link">
    Deploy the new health check code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#343-health-check-code" class="md-nav__link">
    3.4.3 Health check code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#344-verify-elastic-load-balancer-elb-is-configured-to-use-the-new-deep-health-check" class="md-nav__link">
    3.4.4 Verify Elastic Load Balancer (ELB) is configured to use the new deep health check
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#345-observe-behavior-of-web-service-with-added-deep-health-check" class="md-nav__link">
    3.4.5 Observe behavior of web service with added deep health check
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repair-the-server" class="md-nav__link">
    Repair the server
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-fail-open-when-appropriate" class="md-nav__link">
    4. Fail open when appropriate
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-disable-recommendationservice-again" class="md-nav__link">
    4.1 Disable RecommendationService again
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-observe-fail-open-behavior" class="md-nav__link">
    4.2 Observe fail-open behavior
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-tear-down-this-lab" class="md-nav__link">
    5. Tear down this lab 
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#remove-aws-cloudformation-provisioned-resources" class="md-nav__link">
    Remove AWS CloudFormation provisioned resources
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-delete-an-aws-cloudformation-stack" class="md-nav__link">
    How to delete an AWS CloudFormation stack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-workshop-cloudformation-stacks" class="md-nav__link">
    Delete workshop CloudFormation stacks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-cloudwatch-logs" class="md-nav__link">
    Remove CloudWatch logs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references-useful-resources" class="md-nav__link">
    References &amp; useful resources
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#license" class="md-nav__link">
    License
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#documentation-license" class="md-nav__link">
    Documentation License
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-license" class="md-nav__link">
    Code License
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4" type="checkbox" id="nav-4-4">
    
    <label class="md-nav__link" for="nav-4-4">
      Testing Resiliency
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-4">
        Testing Resiliency
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4-1" type="checkbox" id="nav-4-4-1">
    
    <label class="md-nav__link" for="nav-4-4-1">
      200 EC2 Resiliency
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-4-1">
        200 EC2 Resiliency
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../200_Testing_for_Resiliency_of_EC2/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../200_Testing_for_Resiliency_of_EC2/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4-2" type="checkbox" id="nav-4-4-2">
    
    <label class="md-nav__link" for="nav-4-4-2">
      300 EC2, RDS S3 Resiliency
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-4-2">
        300 EC2, RDS S3 Resiliency
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../300_Testing_for_Resiliency_of_EC2_RDS_and_S3/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../300_Testing_for_Resiliency_of_EC2_RDS_and_S3/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../300_Testing_for_Resiliency_of_EC2_RDS_and_S3/TroubleShooting_Guide.html" title="Trouble Shooting Guide" class="md-nav__link">
      Trouble Shooting Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Performance Efficiency
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Performance Efficiency
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Performance/README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Performance/100_Monitoring_with_CloudWatch_Dashboards/README.html" title="Monitoring with CloudWatch Dashboards" class="md-nav__link">
      Monitoring with CloudWatch Dashboards
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Cost Optimization
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Cost Optimization
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Fundamentals.html" title="Fundamentals" class="md-nav__link">
      Fundamentals
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/ExpenditureAwareness.html" title="Expenditure Awareness" class="md-nav__link">
      Expenditure Awareness
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/CostEffectiveResources.html" title="Cost Effective Resources" class="md-nav__link">
      Cost Effective Resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-5" type="checkbox" id="nav-6-5">
    
    <label class="md-nav__link" for="nav-6-5">
      100 Level Labs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-5">
        100 Level Labs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-5-1" type="checkbox" id="nav-6-5-1">
    
    <label class="md-nav__link" for="nav-6-5-1">
      Account Setup
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-5-1">
        Account Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Fundamentals/100_1_AWS_Account_Setup/README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Fundamentals/100_1_AWS_Account_Setup/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-5-2" type="checkbox" id="nav-6-5-2">
    
    <label class="md-nav__link" for="nav-6-5-2">
      Cost and Usage Governance
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-5-2">
        Cost and Usage Governance
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Fundamentals/100_2_Cost_and_Usage_Governance/README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Fundamentals/100_2_Cost_and_Usage_Governance/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-5-3" type="checkbox" id="nav-6-5-3">
    
    <label class="md-nav__link" for="nav-6-5-3">
      Pricing Models
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-5-3">
        Pricing Models
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Fundamentals/100_3_Pricing_Models/README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Fundamentals/100_3_Pricing_Models/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-5-4" type="checkbox" id="nav-6-5-4">
    
    <label class="md-nav__link" for="nav-6-5-4">
      Cost and Usage Analysis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-5-4">
        Cost and Usage Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Fundamentals/100_4_Cost_and_Usage_Analysis/README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Fundamentals/100_4_Cost_and_Usage_Analysis/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-5-5" type="checkbox" id="nav-6-5-5">
    
    <label class="md-nav__link" for="nav-6-5-5">
      Cost and Usage Visualization
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-5-5">
        Cost and Usage Visualization
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Fundamentals/100_5_Cost_Visualization/README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Fundamentals/100_5_Cost_Visualization/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-6" type="checkbox" id="nav-6-6">
    
    <label class="md-nav__link" for="nav-6-6">
      200 Level Labs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-6">
        200 Level Labs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-6-1" type="checkbox" id="nav-6-6-1">
    
    <label class="md-nav__link" for="nav-6-6-1">
      Cost and Usage Governance
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-6-1">
        Cost and Usage Governance
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Fundamentals/200_2_Cost_and_Usage_Governance/README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Fundamentals/200_2_Cost_and_Usage_Governance/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-6-2" type="checkbox" id="nav-6-6-2">
    
    <label class="md-nav__link" for="nav-6-6-2">
      RI Analysis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-6-2">
        RI Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Fundamentals/200_3_Pricing_Models/README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Fundamentals/200_3_Pricing_Models/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-6-3" type="checkbox" id="nav-6-6-3">
    
    <label class="md-nav__link" for="nav-6-6-3">
      Savings Plan Analysis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-6-3">
        Savings Plan Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Effective_Resources/200_Pricing_Model_Analysis/README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Effective_Resources/200_Pricing_Model_Analysis/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-6-4" type="checkbox" id="nav-6-6-4">
    
    <label class="md-nav__link" for="nav-6-6-4">
      Cost and Usage Analysis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-6-4">
        Cost and Usage Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Fundamentals/200_4_Cost_and_Usage_Analysis/README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Fundamentals/200_4_Cost_and_Usage_Analysis/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-6-5" type="checkbox" id="nav-6-6-5">
    
    <label class="md-nav__link" for="nav-6-6-5">
      Cost and Usage Visualization
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-6-5">
        Cost and Usage Visualization
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Fundamentals/200_5_Cost_Visualization/README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_Fundamentals/200_5_Cost_Visualization/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-7" type="checkbox" id="nav-6-7">
    
    <label class="md-nav__link" for="nav-6-7">
      300 Level Labs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-7">
        300 Level Labs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-7-1" type="checkbox" id="nav-6-7-1">
    
    <label class="md-nav__link" for="nav-6-7-1">
      Automated CUR Updates and Ingestion
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-7-1">
        Automated CUR Updates and Ingestion
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_and_Usage_Analysis/300_Automated_CUR_Updates_and_Ingestion/README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_and_Usage_Analysis/300_Automated_CUR_Updates_and_Ingestion/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-7-2" type="checkbox" id="nav-6-7-2">
    
    <label class="md-nav__link" for="nav-6-7-2">
      Multi Account CUR Access
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-7-2">
        Multi Account CUR Access
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_and_Usage_Analysis/300_Multi_Account_CUR_Access/README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_and_Usage_Analysis/300_Multi_Account_CUR_Access/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-7-3" type="checkbox" id="nav-6-7-3">
    
    <label class="md-nav__link" for="nav-6-7-3">
      Splitting Sharing CUR
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-7-3">
        Splitting Sharing CUR
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_and_Usage_Analysis/300_Splitting_Sharing_CUR_Access/README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Cost_and_Usage_Analysis/300_Splitting_Sharing_CUR_Access/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-7-4" type="checkbox" id="nav-6-7-4">
    
    <label class="md-nav__link" for="nav-6-7-4">
      Auto Financial CUR Reports
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-7-4">
        Auto Financial CUR Reports
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Expenditure_Awareness/300_Automated_CUR_Query_and_Email_Delivery/README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Cost/Expenditure_Awareness/300_Automated_CUR_Query_and_Email_Delivery/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Well Architected Tool
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Well Architected Tool
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Well-ArchitectedTool/README.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2" type="checkbox" id="nav-7-2">
    
    <label class="md-nav__link" for="nav-7-2">
      Walkthrough
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-2">
        Walkthrough
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Well-ArchitectedTool/100_Walkthrough_of_the_Well-Architected_Tool/README.html" title="Lab Overview" class="md-nav__link">
      Lab Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Well-ArchitectedTool/100_Walkthrough_of_the_Well-Architected_Tool/Lab_Guide.html" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#author" class="md-nav__link">
    Author
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#amazon-builders-library-and-aws-well-architected" class="md-nav__link">
    Amazon Builders' Library and AWS Well-Architected
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    Table of Contents
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-deploy-the-application" class="md-nav__link">
    1. Deploy the application 
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-log-into-the-aws-console" class="md-nav__link">
    1.1 Log into the AWS console 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-deploy-the-application-using-an-aws-cloudformation-template" class="md-nav__link">
    1.2 Deploy the application using an AWS CloudFormation template
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121-deploy-the-vpc-infrastructure" class="md-nav__link">
    1.2.1 Deploy the VPC infrastructure
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#express-steps-deploy-the-vpc-infrastructure" class="md-nav__link">
    Express Steps (Deploy the VPC infrastructure)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122-deploy-the-web-app-infrastructure-and-service" class="md-nav__link">
    1.2.2 Deploy the web app infrastructure and service
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#express-steps-deploy-the-webapp-infrastructure-and-service" class="md-nav__link">
    Express Steps (Deploy the WebApp infrastructure and service)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-view-the-website-for-web-service" class="md-nav__link">
    1.3 View the website for web service 
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-handle-failure-of-service-dependencies" class="md-nav__link">
    2. Handle failure of service dependencies 
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-system-dependency-initially-healthy" class="md-nav__link">
    2.1 System dependency initially healthy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-simulate-dependency-not-available" class="md-nav__link">
    2.2 Simulate dependency not available
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221-disable-recommendationservice" class="md-nav__link">
    2.2.1 Disable RecommendationService
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-observe-behavior-when-dependency-not-available" class="md-nav__link">
    2.2.2 Observe behavior when dependency not available
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-update-server-code-to-handle-dependency-not-available" class="md-nav__link">
    2.3 Update server code to handle dependency not available
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#231-option-1-expert-option-make-and-deploy-your-changes-to-the-code" class="md-nav__link">
    2.3.1 Option 1 - Expert option: make and deploy your changes to the code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#232-option-2-assisted-option-deploy-workshop-provided-code" class="md-nav__link">
    2.3.2 Option 2 - Assisted option: deploy workshop provided code
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-the-new-error-handling-code" class="md-nav__link">
    Deploy the new error handling code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#233-error-handling-code" class="md-nav__link">
    2.3.3 Error handling code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#234-observe-behavior-of-web-service-with-added-error-handling" class="md-nav__link">
    2.3.4 Observe behavior of web service with added error handling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-implement-deep-health-checks" class="md-nav__link">
    3. Implement deep health checks 
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-re-enable-the-dependency-service" class="md-nav__link">
    3.1 Re-enable the dependency service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-inject-fault-on-a-single-server" class="md-nav__link">
    3.2 Inject fault on a single server 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-observe-application-behavior-and-determine-how-to-fix-it" class="md-nav__link">
    3.4 Observe application behavior and determine how to fix it
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-create-a-deep-healthcheck-to-identify-bad-servers" class="md-nav__link">
    3.4 Create a deep healthcheck to identify bad servers
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#341-option-1-expert-option-make-and-deploy-your-changes-to-the-code" class="md-nav__link">
    3.4.1 Option 1 - Expert option: make and deploy your changes to the code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#342-option-2-assisted-option-deploy-workshop-provided-code" class="md-nav__link">
    3.4.2 Option 2 - Assisted option: deploy workshop provided code
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-the-new-health-check-code" class="md-nav__link">
    Deploy the new health check code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#343-health-check-code" class="md-nav__link">
    3.4.3 Health check code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#344-verify-elastic-load-balancer-elb-is-configured-to-use-the-new-deep-health-check" class="md-nav__link">
    3.4.4 Verify Elastic Load Balancer (ELB) is configured to use the new deep health check
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#345-observe-behavior-of-web-service-with-added-deep-health-check" class="md-nav__link">
    3.4.5 Observe behavior of web service with added deep health check
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repair-the-server" class="md-nav__link">
    Repair the server
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-fail-open-when-appropriate" class="md-nav__link">
    4. Fail open when appropriate
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-disable-recommendationservice-again" class="md-nav__link">
    4.1 Disable RecommendationService again
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-observe-fail-open-behavior" class="md-nav__link">
    4.2 Observe fail-open behavior
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-tear-down-this-lab" class="md-nav__link">
    5. Tear down this lab 
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#remove-aws-cloudformation-provisioned-resources" class="md-nav__link">
    Remove AWS CloudFormation provisioned resources
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-delete-an-aws-cloudformation-stack" class="md-nav__link">
    How to delete an AWS CloudFormation stack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-workshop-cloudformation-stacks" class="md-nav__link">
    Delete workshop CloudFormation stacks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-cloudwatch-logs" class="md-nav__link">
    Remove CloudWatch logs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references-useful-resources" class="md-nav__link">
    References &amp; useful resources
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#license" class="md-nav__link">
    License
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#documentation-license" class="md-nav__link">
    Documentation License
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-license" class="md-nav__link">
    Code License
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/awslabs/aws-well-architected-labs/edit/master/docs/Reliability/300_Health_Checks_and_Dependencies/Lab_Guide.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="level-300-implementing-health-checks-and-managing-dependencies-to-improve-reliability">Level 300: Implementing Health Checks and Managing Dependencies to Improve Reliability</h1>
<h2 id="author">Author</h2>
<ul>
<li>Seth Eliot, Reliability Lead, Well-Architected, AWS</li>
</ul>
<h2 id="amazon-builders-library-and-aws-well-architected">Amazon Builders' Library and AWS Well-Architected</h2>
<p>This lab illustrates best practices for reliability as described in the <a href="https://aws.amazon.com/architecture/well-architected/">AWS Well-Architected</a> Reliability pillar. It focuses on resiliency practices described in the Amazon Builders' Library article: <a href="https://aws.amazon.com/builders-library/implementing-health-checks/">Implementing health checks</a>.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#deploy_app">Deploy the application</a></li>
<li><a href="#handle_dependency">Handle failure of service dependencies</a></li>
<li><a href="#deep_healthcheck">Implement deep health checks</a></li>
<li><a href="#fail_open">Fail open when appropriate</a></li>
<li><a href="#tear_down">Tear down this lab</a></li>
</ol>
<h2 id="1-deploy-the-application">1. Deploy the application <a name="deploy_app"></a></h2>
<p>You will create a multi-tier architecture using AWS and run a simple service on it. The service is a web server running on Amazon EC2 fronted by an Elastic Load Balancer reverse-proxy, with a dependency on Amazon DynamoDB.</p>
<p><strong>Note</strong>: The concepts covered by this lab apply whether your service dependency is an AWS resource like Amazon DynamoDB, or an external service called via API. The DynamoDB dependency here acts as a <em>mock</em> for an external service called <strong>RecommendationService</strong>. The <strong>getRecommendation</strong> API on this service is a dependency for the web service used in this lab.  <strong>getRecommendation</strong> is actually a <code>get_item</code> call to a DynamoDB table.</p>
<p><img alt="ArchitectureOverview" src="Images/ArchitectureOverview.png" /></p>
<h3 id="11-log-into-the-aws-console">1.1 Log into the AWS console <a name="awslogin"></a></h3>
<p><strong>If you are attending an in-person workshop and were provided with an AWS account by the instructor</strong>:</p>
<ul>
<li>Follow the instructions <a href="../../common/documentation/Workshop_AWS_Account.html">here for accessing your AWS account</a></li>
</ul>
<p><strong>If you are using your own AWS account</strong>:</p>
<ul>
<li>Sign in to the AWS Management Console as an IAM user who has PowerUserAccess or AdministratorAccess permissions, to ensure successful execution of this lab.</li>
</ul>
<h3 id="12-deploy-the-application-using-an-aws-cloudformation-template">1.2 Deploy the application using an AWS CloudFormation template</h3>
<p>You will deploy the service infrastructure including simple service code and some sample data.</p>
<ol>
<li>It is recommended that you use the <strong>Ohio</strong> region.  This region is also known as <strong>us-east-2</strong>, which you will see referenced throughout this lab.
<img alt="SelectOhio" src="Images/SelectOhio.png" /><ul>
<li>If you choose to use a different region, you will need to ensure future steps are consistent with your region choice.</li>
</ul>
</li>
</ol>
<h4 id="121-deploy-the-vpc-infrastructure">1.2.1 Deploy the VPC infrastructure</h4>
<ul>
<li>If you are comfortable deploying a CloudFormation stack, then use the <strong>express steps</strong> listed immediately below.</li>
<li>If you need additional guidance in how to deploy a CloudFormation stack, then follow the directions for the <a href="../../Security/200_Automated_Deployment_of_VPC/Lab_Guide.html">Automated Deployment of VPC</a> lab, and then return here for the next step: <strong>1.2.2 Deploy the web service infrastructure and service</strong></li>
</ul>
<h5 id="express-steps-deploy-the-vpc-infrastructure">Express Steps (Deploy the VPC infrastructure)</h5>
<ol>
<li>Download the <a href="https://raw.githubusercontent.com/awslabs/aws-well-architected-labs/master/Security/200_Automated_Deployment_of_VPC/Code/vpc-alb-app-db.yaml"><em>vpc-alb-app-db.yaml</em></a> CloudFormation template</li>
<li>Create a CloudFormation stack (with new resources) by uploading this CloudFormation Template file</li>
<li>For <strong>Stack name</strong> use <strong><code>WebApp1-VPC</code></strong> (case sensitive)</li>
<li>Leave all  CloudFormation Parameters at their default values</li>
<li>Click <strong>Next</strong> until the last page</li>
<li>At the bottom of the page, select <strong>I acknowledge that AWS CloudFormation might create IAM resources with custom names</strong></li>
<li>Click <strong>Create stack</strong></li>
</ol>
<h4 id="122-deploy-the-web-app-infrastructure-and-service">1.2.2 Deploy the web app infrastructure and service</h4>
<p>Wait until the VPC CloudFormation stack <strong>status</strong> is <em>CREATE_COMPLETE</em>, then continue. This will take about four minutes.</p>
<ul>
<li>If you are comfortable deploying a CloudFormation stack, then use the <strong>express steps</strong> listed immediately below.</li>
<li>If you need additional guidance in how to deploy a CloudFormation stack, then follow the directions for the <a href="Documentation/CFNCreateStack.html">Create an AWS CloudFormation Stack from a template</a> lab, and then return here for the next step: <strong>1.3 View the website for web service</strong></li>
</ul>
<h5 id="express-steps-deploy-the-webapp-infrastructure-and-service">Express Steps (Deploy the WebApp infrastructure and service)</h5>
<ol>
<li>Download the <a href="https://raw.githubusercontent.com/awslabs/aws-well-architected-labs/master/Reliability/300_Health_Checks_and_Dependencies/Code/CloudFormation/staticwebapp.yaml"><em>staticwebapp.yaml</em></a> CloudFormation template</li>
<li>Create a CloudFormation stack (with new resources) by uploading this CloudFormation Template file</li>
<li>For <strong>Stack name</strong> use <strong><code>HealthCheckLab</code></strong></li>
<li>Leave all  CloudFormation Parameters at their default values</li>
<li>Click <strong>Next</strong> until the last page</li>
<li>At the bottom of the page, select <strong>I acknowledge that AWS CloudFormation might create IAM resources with custom names</strong></li>
<li>Click <strong>Create stack</strong></li>
</ol>
<h3 id="13-view-the-website-for-web-service">1.3 View the website for web service <a name="website"></a></h3>
<ol>
<li>
<p>Go to the AWS CloudFormation console at <a href="https://console.aws.amazon.com/cloudformation">https://console.aws.amazon.com/cloudformation</a>.</p>
<ul>
<li>Wait until <strong>HealthCheckLab</strong> stack <strong>status</strong> is <em>CREATE_COMPLETE</em> before proceeding. This should take about four minutes</li>
<li>Click on the <strong>HealthCheckLab</strong> stack</li>
<li>Click on the <strong>Outputs</strong> tab</li>
<li>For the Key <strong>WebsiteURL</strong> copy the value.  This is the URL of your test web service<ul>
<li><em>Hint</em>: it will start with <em><code>http://healt-alb</code></em> and end in <em><code>&lt;aws region&gt;.elb.amazonaws.com</code></em></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Click the URL and it will bring up the website:<br />
<img alt="DemoWebsite" src="Images/DemoWebsite.png" /></p>
</li>
<li>
<p>The website simulates a recommendation engine making personalized suggestions for classic television shows. You should note the following features:</p>
<ul>
<li>Area A shows the personalized recommendation<ul>
<li>It shows first name of the user and the show that was recommended</li>
<li>The workshop simulation is simple. On every request it chooses a user at random, and shows a recommendation statically mapped to that user. The user names, television show names, and this mapping are in a DynamoDB table, which is simulating the <strong>RecommendationService</strong></li>
</ul>
</li>
<li>Area B shows metadata which is useful to you during the lab<ul>
<li>The <strong>instance_id</strong> and <strong>availability_zone</strong> enable you to see which EC2 server and Availability Zone were used for each request</li>
<li>There is one EC2 instance deployed per Availability Zone</li>
<li>Refresh the website several times, note that the EC2 instance and Availability Zone change from among the three available</li>
<li>This is Elastic Load Balancing (ELB) distributing these stateless requests among the available EC2 server instances across Availability Zones</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th align="center">Well-Architected for Reliability: Best practices</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>Use highly available network connectivity for your workload public endpoints</strong>: Elastic Load Balancing provides load balancing across Availability Zones, performs Layer 4 (TCP) or Layer 7 (http/https) routing, integrates with AWS WAF, and integrates with AWS Auto Scaling to help create a self-healing infrastructure and absorb increases in traffic while releasing resources when traffic decreases.</td>
</tr>
<tr>
<td align="center"><strong>Implement loosely coupled dependencies</strong>: Dependencies such as queuing systems, streaming systems, workflows, and load balancers are loosely coupled. Loose coupling helps isolate behavior of a component from other components that depend on it, increasing resiliency and agility.</td>
</tr>
<tr>
<td align="center"><strong>Deploy the workload to multiple locations</strong>: Distribute workload data and resources across multiple Availability Zones or, where necessary, across AWS Regions. These locations can be as diverse as required.</td>
</tr>
</tbody>
</table>
</li>
</ol>
<h2 id="2-handle-failure-of-service-dependencies">2. Handle failure of service dependencies <a name="handle_dependency"></a></h2>
<h3 id="21-system-dependency-initially-healthy">2.1 System dependency initially healthy</h3>
<ol>
<li>You already observed that all three EC2 instances are successfully serving requests</li>
<li>In a new tab navigate to ELB Target Groups console<ul>
<li>By <a href="http://console.aws.amazon.com/ec2/v2/home?region=us-east-2#TargetGroups:">clicking here to open the AWS Management Console</a></li>
<li><em>or</em> navigating through the AWS Management Console: <strong>Services</strong> &gt; <strong>EC2</strong> &gt; <strong>Load Balancing</strong> &gt; <strong>Target Groups</strong></li>
<li>Leave this tab open as you will be referring back to it multiple times</li>
</ul>
</li>
<li>Click on the <strong>Targets</strong> tab (bottom half of screen)</li>
<li>Under <strong>Registered Targets</strong> observe the three EC2 instances serving your web service</li>
<li>
<p>Note that they are all <em>healthy</em> (see <strong>Status</strong> and <strong>Description</strong>)</p>
<ul>
<li>In this state the ELB will route traffic to any of the three servers</li>
</ul>
<p><img alt="TargetGroupAllHealthy" src="Images/TargetGroupAllHealthy.png" /></p>
</li>
<li>
<p>From the <strong>Target Groups</strong> console, now click on the the <strong>Health checks</strong> tab</p>
<ul>
<li>Note here that the <strong>Path</strong> is configured to <code>/healthcheck</code></li>
</ul>
</li>
<li>
<p>Copy the URL of the web service to a new tab and append <code>/healthcheck</code> to the end of the URL</p>
<ul>
<li>
<p>The new URL should look like:</p>
<pre><code>http://healt-alb1l-&lt;...&gt;.elb.amazonaws.com/healthcheck
</code></pre>
</li>
<li>
<p>Refresh several times and observe the health check on the three servers</p>
</li>
<li>Note the check is successful</li>
</ul>
</li>
<li>
<p>The EC2 servers receive user requests (for a TV show recommendation) on the path <code>/</code> and they receive health check requests from the Elastic Load Balancer on the path <code>/healthcheck</code></p>
<ul>
<li>The health check always returns an http 200 code for any request to it.</li>
<li>The server code running on each EC2 instance <a href="https://github.com/awslabs/aws-well-architected-labs/blob/master/Reliability/300_Health_Checks_and_Dependencies/Code/Python/server_basic.py">can be viewed here</a>, or you can view the health check code excerpt below:</li>
</ul>
</li>
</ol>
<details>
<summary>Click here to see the health check code excerpt</summary>

<pre><code class="python"># Healthcheck request - will be used by the Elastic Load Balancer
elif self.path == '/healthcheck':

      # Return a healthy code
      self.send_response(200)
      self.send_header('Content-type', 'text/html')
      self.end_headers()
</code></pre>


</details>

<h3 id="22-simulate-dependency-not-available">2.2 Simulate dependency not available</h3>
<h4 id="221-disable-recommendationservice">2.2.1 Disable RecommendationService</h4>
<p>You will now simulate a complete failure of the <strong>RecommendationService</strong>. Every request in turn makes a (simulated) call to the <strong>getRecommendation</strong> API on this service. These will all fail for every request on every server.</p>
<ol>
<li>In a new tab, navigate to the Parameter Store on the AWS Systems Manager console<ul>
<li>By <a href="https://console.aws.amazon.com/systems-manager/parameters">clicking here to open the AWS Management Console</a></li>
<li><em>or</em> navigating through the AWS Management Console: <strong>Services</strong> &gt; <strong>Systems Manager</strong> &gt; <strong>Parameter Store</strong></li>
<li>Leave this tab open as you will be referring back to it one additional time</li>
</ul>
</li>
<li>Click on <strong>RecommendationServiceEnabled</strong></li>
<li>Click <strong>Edit</strong></li>
<li>In the <strong>Value</strong> box, type <strong>false</strong></li>
<li>Click <strong>Save Changes</strong><ul>
<li>A status message should say <em>Edit parameter request succeeded</em></li>
</ul>
</li>
</ol>
<p>The <strong>RecommendationServiceEnabled</strong> parameter is used only for this lab. The server code reads its value, and simulates a failure in <strong>RecommendationService</strong> (all reads to the DynamoDB table simulating the service will fail) when it is <strong>false</strong>.</p>
<h4 id="222-observe-behavior-when-dependency-not-available">2.2.2 Observe behavior when dependency not available</h4>
<ol>
<li>Refresh the test web service multiple times<ul>
<li>Note that it fails with <em>502 Bad Gateway</em></li>
<li>For each request one of the servers receiving the request attempts to call the <strong>RecommendationService</strong> but catastrophically fails and fails to return a reply (empty reply) to the load balancer, which in turn presents this as a http 502 failure.</li>
</ul>
</li>
<li>You can observe this by opening a new tab and navigating to ELB Load Balancers console:<ul>
<li>By <a href="http://console.aws.amazon.com/ec2/v2/home?region=us-east-2#LoadBalancers:">clicking here to open the AWS Management Console</a></li>
<li><em>or</em> navigating through the AWS Management Console: <strong>Services</strong> &gt; <strong>EC2</strong> &gt; <strong>Load Balancing</strong> &gt; <strong>Load Balancers</strong></li>
</ul>
</li>
<li>
<p>Click on the <strong>Monitoring</strong> tab (bottom half of screen)</p>
<ul>
<li>Observe the <strong>ELB 5XXs (Count)</strong> and <strong>HTTP 502s (Count)</strong> errors for the load balancer</li>
<li>It will take a minute for the metrics to show up.  Make sure you refresh the web service page multiple times in your browser</li>
<li>These are the error codes the <em>load balancer</em> returns on every request during this simulated outage</li>
</ul>
<p><img alt="502LoadBalancerMetrics" src="Images/502LoadBalancerMetrics.png" /></p>
</li>
<li>
<p>Compare these metrics to those for the target group (the EC2 servers themselves)</p>
<ul>
<li>Return to the <strong>Target Groups</strong> console and click the <strong>Monitoring</strong> tab there</li>
<li>Observe <strong>HTTP 5XXs ( Count )</strong> errors shows no data</li>
<li>The servers themselves are <em>not</em> returning actual http error codes, they are failing to return any data at all</li>
</ul>
<p><img alt="502TargetGroupMetrics" src="Images/502TargetGroupMetrics.png" /></p>
<ul>
<li>We need to update the server code to handle when the dependency is not available</li>
</ul>
</li>
</ol>
<h3 id="23-update-server-code-to-handle-dependency-not-available">2.3 Update server code to handle dependency not available</h3>
<p>The <strong>getRecommendation</strong> API is actually a <code>get_item</code> call on a DynamoDB table. Examine the server code to see how errors are currently handled</p>
<ol>
<li>The server code running on each EC2 instance <a href="https://github.com/awslabs/aws-well-architected-labs/blob/master/Reliability/300_Health_Checks_and_Dependencies/Code/Python/server_basic.py">can be viewed here</a></li>
<li>
<p>Search for the call to the <strong>RecommendationService</strong>. It looks like this:</p>
<pre><code>response = call_getRecommendation(self.region, user_id)
</code></pre>
<ul>
<li>What happens if this call fails?</li>
<li>Choose <em>one</em> of the options below (<strong>Option 1 - Expert</strong> or <strong>Option 2 - Assisted</strong>) to improve the code and handle the failure</li>
</ul>
</li>
</ol>
<h4 id="231-option-1-expert-option-make-and-deploy-your-changes-to-the-code">2.3.1 Option 1 - Expert option: make and deploy your changes to the code</h4>
<p>You may choose this option, or skip to <strong>Option 2 - Assisted option</strong></p>
<p>This option requires you have access to place a file in a location accessible via https/https via a URL. For example a public readable S3 bucket, <a href="https://gist.github.com">gist</a> (use the <strong>raw</strong> option to get the URL), or your private webserver.</p>
<ol>
<li>Download the existing server code from here: <a href="https://raw.githubusercontent.com/awslabs/aws-well-architected-labs/master/Reliability/300_Health_Checks_and_Dependencies/Code/Python/server_basic.py">server_basic.py</a></li>
<li>Modify the code to handle the call to the <strong>RecommendationService</strong></li>
<li>When the call to <strong>RecommendationService</strong> fails then instead of using the response data you requested and did not get, return a static response:<ul>
<li>Instead of user first name return <strong>Valued Customer</strong></li>
<li>Instead of a personalized recommended TV show, return <strong>I Love Lucy</strong></li>
<li>Try to also return some diagnostic information on the cause of the error</li>
</ul>
</li>
<li>Put your updated server code in a location where it can be downloaded via its URL using <strong>wget</strong></li>
<li>In the AWS Console go the <strong>HealthCheckLab</strong> CloudFormation stack and <strong>Update</strong> it:<ul>
<li>Leave <strong>Use current template</strong> selected and click <strong>Next</strong></li>
<li>Find the <strong>ServerCodeUrl</strong> parameter and enter the URL for your new code</li>
<li>When stack <strong>status</strong> is <em>CREATE_COMPLETE</em> (about four minutes) then continue</li>
</ul>
</li>
</ol>
<p>If you completed the <strong>Option 1 - Expert option</strong>, then skip the <strong>Option 2 - Assisted option</strong> section and continue with <strong>2.3.3 Error handling code</strong></p>
<h4 id="232-option-2-assisted-option-deploy-workshop-provided-code">2.3.2 Option 2 - Assisted option: deploy workshop provided code</h4>
<ol>
<li>The new server code including error handling <a href="https://github.com/awslabs/aws-well-architected-labs/blob/master/Reliability/300_Health_Checks_and_Dependencies/Code/Python/server_errorhandling.py">can be viewed here</a></li>
<li>Search for <code>Error handling</code> in the comments (occurs twice). What will this code do now if the dependency call fails?</li>
</ol>
<h5 id="deploy-the-new-error-handling-code">Deploy the new error handling code</h5>
<ol>
<li>Navigate to the AWS CloudFormation console</li>
<li>Click on the <strong>HealthCheckLab</strong> stack</li>
<li>Click <strong>Update</strong></li>
<li>Leave <strong>Use current template</strong> selected and click <strong>Next</strong></li>
<li>
<p>Find the <strong>ServerCodeUrl</strong> parameter and enter the following:</p>
<pre><code>https://aws-well-architected-labs-ohio.s3.us-east-2.amazonaws.com/Healthcheck/Code/server_errorhandling.py
</code></pre>
</li>
<li>
<p>Click <strong>Next</strong> until the last page</p>
</li>
<li>At the bottom of the page, select <strong>I acknowledge that AWS CloudFormation might create IAM resources with custom names</strong></li>
<li>Click <strong>Update stack</strong></li>
<li>Click on <strong>Events</strong>, and click the refresh icon to observe the stack progress<ul>
<li>New EC2 instances running the error handling code are being deployed</li>
<li>When stack <strong>status</strong> is <em>CREATE_COMPLETE</em> (about four minutes) then continue</li>
</ul>
</li>
</ol>
<h4 id="233-error-handling-code">2.3.3 Error handling code</h4>
<p>This is the error handling code from <a href="https://github.com/awslabs/aws-well-architected-labs/blob/master/Reliability/300_Health_Checks_and_Dependencies/Code/Python/server_errorhandling.py">server_errorhandling.py</a>. The <strong>Option 2 - Assisted option</strong> uses this code. If you used the <strong>Option 1 - Expert option</strong>, you can consult this code as a guide.</p>
<details>
<summary>Click here to see code</summary>

<pre><code class="python"># Error handling:
# surround the call to RecommendationService in a try catch
try:

    # Call the getRecommendation API on the RecommendationService
    response = call_getRecommendation(self.region, user_id)

    # Parses value of recommendation from DynamoDB JSON return value
    # {'Item': {
    #     'ServiceAPI': {'S': 'getRecommendation'},
    #     'UserID': {'N': '1'},
    #     'Result': {'S': 'M*A*S*H'},  ...
    tv_show = response['Item']['Result']['S']
    user_name = response['Item']['UserName']['S']
    message += recommendation_message (user_name, tv_show, True)

# Error handling:
# If the service dependency fails, and we cannot make a personalized recommendation
# then give a pre-selected (static) recommendation
# and report diagnostic information
except Exception as e:
    message += recommendation_message ('Valued Customer', 'I Love Lucy', False)
    message += '&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h2&gt;Diagnostic Info:&lt;/h2&gt;'
    message += '&lt;br&gt;We are unable to provide personalized recommendations'
    message += '&lt;br&gt;If this persists, please report the following info to us:'
    message += str(traceback.format_exception_only(e.__class__, e))
</code></pre>


</details>

<h4 id="234-observe-behavior-of-web-service-with-added-error-handling">2.3.4 Observe behavior of web service with added error handling</h4>
<ol>
<li>
<p>After the new error-handling code has successfully deployed, refresh the test web service page multiple times. Observe:</p>
<ul>
<li>It works. It no longer returns an error</li>
<li>All three EC2 instances and Availability Zones are being used</li>
<li>A default recommendation for <strong>Valued Customer</strong> is displayed instead of a user-personalized one</li>
<li>There is now <strong>Diagnostic Info</strong>. What does it mean?</li>
</ul>
</li>
<li>
<p>Refer back to the newly deployed code to understand why the website behaves this way now</p>
</li>
</ol>
<p>The Website is working again, but in a degraded capacity since it is no longer serving personalized recommendations. While this is less than ideal, it is much better than when it was failing with http 502 errors. The <strong>RecommendationService</strong> is not available, so the app instead returns a <em>static response</em> (the default recommendation) instead of the data it would have obtained from <strong>RecommendationService</strong>.</p>
<table>
<thead>
<tr>
<th align="center">Well-Architected for Reliability: Best practice</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>Implement graceful degradation to transform applicable hard dependencies into soft dependencies</strong>: When a component's dependencies are unhealthy, the component itself can still function, although in a degraded manner. For example, when a dependency call fails, instead use a predetermined static response.</td>
</tr>
</tbody>
</table>
<h2 id="3-implement-deep-health-checks">3. Implement deep health checks <a name="deep_healthcheck"></a></h2>
<h3 id="31-re-enable-the-dependency-service">3.1 Re-enable the dependency service</h3>
<p>For the next part of the lab restore access to the <strong>getRecommendation</strong> API on the <strong>RecommendationService</strong></p>
<ol>
<li>Return to the <strong>AWS Systems Manager</strong> &gt; <strong>Parameter Store</strong> on the AWS Management Console</li>
<li>Set the value of <strong>RecommendationServiceEnabled</strong> back to <strong>true</strong> and <strong>Save changes</strong></li>
<li>Confirm the web service is now returning "personalized" recommendations again</li>
</ol>
<h3 id="32-inject-fault-on-a-single-server">3.2 Inject fault on a single server <a name="change_role"></a></h3>
<p>Previously you simulated a failure of the service dependency. Now you will simulate a failure on a single server (of the three servers running). You will simulate a fault on this server that prevents only it from calling the otherwise healthy service dependency.</p>
<ol>
<li>Navigate to the <a href="https://console.aws.amazon.com/ec2/v2/home?LoadBalancers:&amp;region=us-east-2#Instances:">EC2 Instances console</a><ul>
<li>There should be three EC2 instances with <strong>Instance State</strong> <em>running</em>, one in each Availability Zone (they will have <strong>Name</strong> <em>WebApp1</em>)</li>
<li>Click the gear icon in the upper-right and select <strong>IAM Instance Profile Name</strong> (in addition to what is already selected)</li>
</ul>
</li>
<li>Select only the EC2 instance in <strong>Availability Zone</strong> <em>us-east-2c</em></li>
<li>Click <strong>Action</strong> &gt; <strong>Instance Settings</strong> &gt; <strong>Attach/Replace IAM Role</strong></li>
<li>
<p>From <strong>IAM role</strong>, click <strong>WebApp1-EC2-noDDB-Role-HealthCheckLab</strong></p>
<p><img alt="ReplaceIAMRole" src="Images/ReplaceIAMRole.png" /></p>
</li>
<li>
<p>Click <strong>Apply</strong></p>
</li>
<li>Click <strong>Close</strong></li>
<li>This will return you to the EC2 Instances console. Observe under <strong>IAM Instance Profile Name</strong> (it is one of the displayed columns) which IAM roles each EC2 instance has attached</li>
</ol>
<p>The IAM role attached to an EC2 instance determines what permissions it has to access AWS resources. You changed the role of the us-east-2c instance to one that is almost the same as the other two, except it does not have access to DynamoDB. Since DynamoDB is used to mock our service dependency, the us-east-2c server no longer has access to the service dependency (<strong>RecommendationService</strong>). Stale credentials is an actual fault that servers might experience. Your actions above simulate stale (invalid) credentials on the us-east-2c server.</p>
<h3 id="34-observe-application-behavior-and-determine-how-to-fix-it">3.4 Observe application behavior and determine how to fix it</h3>
<ul>
<li>Observe the website behavior now<ul>
<li>Refresh the website multiple times noting which Availability Zone the serving the request</li>
<li>The servers in us-east-2a and us-east-2b continue to function normally</li>
<li>The server in us-east-2c still succeeds, but it uses the static response. Why is this?</li>
</ul>
</li>
<li>The service dependency <strong>RecommendationServiceEnabled</strong> is still healthy</li>
<li>It is the server in us-east-2c that is unhealthy - it has stale credentials<ul>
<li>Return to the <strong>Target Groups</strong> and under the <strong>Targets</strong> tab observe the results of the ELB health checks</li>
<li>They are all <strong>Status</strong> <em>healthy</em>, and are therefore all receiving traffic. Why does the server in us-east-2c show <em>healthy</em> for this check?</li>
</ul>
</li>
<li>
<p>The service would deliver a <em>better experience</em> if it:</p>
<ul>
<li>Identified the us-east-2c server as unhealthy and did not route traffic to it</li>
<li>Replaced this server with a healthy one</li>
</ul>
<table>
<thead>
<tr>
<th align="center">Well-Architected for Reliability: Best practices</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>Make services stateless where possible</strong>: Services should either not require state, or should offload state such that between different client requests, there is no dependence on locally stored data on disk or in memory. This enables servers to be replaced at will without causing an availability impact. Amazon ElastiCache or Amazon DynamoDB are good destinations for offloaded state.</td>
</tr>
<tr>
<td align="center"><strong>Automate healing on all layers</strong>: Upon detection of a failure, use automated capabilities to perform actions to remediate. <em>Ability to restart</em> is an important tool to remediate failures. As discussed previously for distributed systems, a best practice is to make services stateless where possible. This prevents loss of data or availability on restart. In the cloud, you can (and generally should) replace the entire resource (for example, EC2 instance, or Lambda function) as part of the restart. The restart itself is a simple and reliable way to recover from failure. Many different types of failures occur in workloads. Failures can occur in hardware, software, communications, and operations. Rather than constructing novel mechanisms to trap, identify, and correct each of the different types of failures, map many different categories of failures to the same recovery strategy.  An instance might fail due to hardware failure, an operating system bug, memory leak, or other causes. Rather than building custom remediation for each situation, treat any of them as an instance failure. Terminate the instance, and allow AWS Auto Scaling to replace it. Later, carry out the analysis on the failed resource out of band.</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>From the <strong>Target Groups</strong> console click on the  the <strong>Health checks</strong> tab</p>
<ul>
<li>The ELB health check is configured to return <em>healthy</em> when it receives an http 200 response on the <code>/healthcheck</code> path</li>
<li>Since the healthcheck code simply always returns http 200, the <em>bad</em> server still returns http 200 and is seen as <em>healthy</em>.</li>
</ul>
</li>
</ul>
<h3 id="34-create-a-deep-healthcheck-to-identify-bad-servers">3.4 Create a deep healthcheck to identify bad servers</h3>
<ul>
<li>Update server code to add a deep health check response<ul>
<li>You will create and configure a new health check that will include a check on whether the server can access its dependency</li>
<li>This is a <em>deep health check</em> -- it checks the actual function of the server including the ability to call service dependencies</li>
</ul>
</li>
<li>This will be implemented by updating the server code on the <code>/healthcheck</code> path</li>
</ul>
<p>Choose <em>one</em> of the options below (<strong>Option 1 - Expert</strong> or <strong>Option 2 - Assisted</strong>) to improve the code and add the deep health check.</p>
<h4 id="341-option-1-expert-option-make-and-deploy-your-changes-to-the-code">3.4.1 Option 1 - Expert option: make and deploy your changes to the code</h4>
<p>You may choose this option, or skip to <strong>Option 2 - Assisted option</strong></p>
<p>This option requires you have access to place a file in a location accessible via https/https via a URL. For example a public readable S3 bucket, <a href="https://gist.github.com">gist</a> (use the <strong>raw</strong> option to get the URL), or your private webserver.</p>
<ol>
<li>Start the existing server code that you added error handling to, or alternatively download the lab sample code from here: <a href="https://raw.githubusercontent.com/awslabs/aws-well-architected-labs/master/Reliability/300_Health_Checks_and_Dependencies/Code/Python/server_errorhandling.py">server_errorhandling.py</a></li>
<li>Calls to <code>/healthcheck</code> should in turn make a test call to <strong>RecommendationService</strong>  using <em>User ID</em> <strong>0</strong><ul>
<li>If the <strong>RecommendationService</strong> returns the string <strong>test</strong> for both <em>Result</em> and <em>UserName</em> then it is healthy</li>
<li>If it is healthy then return http code 200 (OK)</li>
<li>If it is not healthy then return http code 503 (Service Unavailable)</li>
<li>Also return the same EC2 meta-data that is returned on the call to the <code>/</code> path</li>
</ul>
</li>
<li>Put your updated server code in a location where it can be downloaded via its URL using <strong>wget</strong></li>
<li>In the AWS Console go the <strong>HealthCheckLab</strong> CloudFormation stack and <strong>Update</strong> it:<ul>
<li>Leave <strong>Use current template</strong> selected and click <strong>Next</strong></li>
<li>Find the <strong>ServerCodeUrl</strong> parameter and enter the URL for your new code</li>
<li>When stack <strong>status</strong> is <em>CREATE_COMPLETE</em> (about four minutes) then continue</li>
</ul>
</li>
</ol>
<p>If you completed the <strong>Option 1 - Expert option</strong>, then skip the <strong>Option 2 - Assisted option</strong> section and continue with <strong>3.4.3 Health check code</strong></p>
<h4 id="342-option-2-assisted-option-deploy-workshop-provided-code">3.4.2 Option 2 - Assisted option: deploy workshop provided code</h4>
<ol>
<li>The new server code including error handling <a href="https://github.com/awslabs/aws-well-architected-labs/blob/master/Reliability/300_Health_Checks_and_Dependencies/Code/Python/server_healthcheck.py">can be viewed here</a></li>
<li>Search for <code>Healthcheck request</code> in the comments. What will this code do now if called on this health check URL?</li>
</ol>
<h5 id="deploy-the-new-health-check-code">Deploy the new health check code</h5>
<ol>
<li>Navigate to the AWS CloudFormation console</li>
<li>Click on the <strong>HealthCheckLab</strong> stack</li>
<li>Click <strong>Update</strong></li>
<li>Leave <strong>Use current template</strong> selected and click <strong>Next</strong></li>
<li>
<p>Find the <strong>ServerCodeUrl</strong> parameter and enter the following:</p>
<pre><code>https://aws-well-architected-labs-ohio.s3.us-east-2.amazonaws.com/Healthcheck/Code/server_healthcheck.py
</code></pre>
</li>
<li>
<p>Click <strong>Next</strong> until the last page</p>
</li>
<li>At the bottom of the page, select <strong>I acknowledge that AWS CloudFormation might create IAM resources with custom names</strong></li>
<li>Click <strong>Update stack</strong></li>
<li>Click on <strong>Events</strong>, and click the refresh icon to observe the stack progress<ul>
<li>New EC2 instances running the error handling code are being deployed</li>
<li>When stack <strong>status</strong> is <em>CREATE_COMPLETE</em> (about four minutes) then continue</li>
</ul>
</li>
</ol>
<h4 id="343-health-check-code">3.4.3 Health check code</h4>
<p>This is the health check code from <a href="https://github.com/awslabs/aws-well-architected-labs/blob/healthchecklab/Reliability/300_Health_Checks_and_Dependencies/Code/Python/server_healthcheck.py">server_healthcheck.py</a>. The <strong>Option 2 - Assisted option</strong> uses this code. If you used the <strong>Option 1 - Expert option</strong>, you can consult this code as a guide.</p>
<details>
<summary>Click here to see code</summary>

<pre><code class="python"># Healthcheck request - will be used by the Elastic Load Balancer
elif self.path == '/healthcheck':

    is_healthy = False
    error_msg = ''
    TEST = 'test'

    # Make a request to RecommendationService using a predefined
    # test call as part of health assessment for this server
    try:
        # call RecommendationService using the test user
        user_id = str(0)
        response = call_getRecommendation(self.region, user_id)

        # Parses value of recommendation from DynamoDB JSON return value
        tv_show = response['Item']['Result']['S']
        user_name = response['Item']['UserName']['S']

        # Server is healthy of RecommendationService returned the expected response
        is_healthy = (tv_show == TEST) and (user_name == TEST)

    # If the service dependency fails, capture diagnostic info
    except Exception as e:
        error_msg += str(traceback.format_exception_only(e.__class__, e))

    # Based on the health assessment
    # If it succeeded return a healthy code
    # If it failed return a server failure code
    message = &quot;&quot;
    if (is_healthy):
        self.send_response(200)
        self.send_header('Content-type', 'text/html')
        self.end_headers()

        message += &quot;&lt;h1&gt;Success&lt;/h1&gt;&quot;

        # Add metadata
        message += get_metadata()

    else:
        self.send_response(503)
        self.send_header('Content-type', 'text/html')
        self.end_headers()

        message += &quot;&lt;h1&gt;Fail&lt;/h1&gt;&quot;
        message += &quot;&lt;h3&gt;Error message:&lt;/h3&gt;&quot;
        message += error_msg

        # Add metadata
        message += get_metadata()

    self.wfile.write(
        bytes(
            html.format(Title=&quot;healthcheck&quot;, Content=message),
            &quot;utf-8&quot;
        )
    )
</code></pre>


</details>

<h4 id="344-verify-elastic-load-balancer-elb-is-configured-to-use-the-new-deep-health-check">3.4.4 Verify Elastic Load Balancer (ELB) is configured to use the new deep health check</h4>
<ol>
<li>From the <strong>Target Groups</strong> console click on the the <strong>Health checks</strong> tab</li>
<li>For <strong>Path</strong> verify the value is <code>/healthcheck</code></li>
<li>Click the <strong>Targets</strong> tab so you can monitor health check status</li>
</ol>
<h4 id="345-observe-behavior-of-web-service-with-added-deep-health-check">3.4.5 Observe behavior of web service with added deep health check</h4>
<ul>
<li>Continue the lab after the <strong>HealthCheckLab</strong> CloudFormation stack is complete.</li>
</ul>
<p>The CloudFormation stack update reset the EC2 instance IAM roles, so the system is back to its original no-fault state. You will re-introduce the single-server fault and observe the new behavior.</p>
<ol>
<li>Refresh the web service multiple times and note all three servers are functioning without error</li>
<li>
<p>Copy the URL of the web service to a new tab and append <code>/healthcheck</code> to the end of the URL</p>
<ul>
<li>
<p>The new URL should look like:</p>
<pre><code>http://healt-alb1l-&lt;...&gt;.elb.amazonaws.com/healthcheck
</code></pre>
</li>
<li>
<p>Refresh several times and observe the health check on the three servers</p>
</li>
<li>Note the check is successful - the check now includes a call to the <strong>RecommendationService</strong> (the DynamoDB table)</li>
<li>Go to the <strong>Target Groups</strong> console click on the <strong>Targets</strong> tab and note the health status as per the ELB health checks.</li>
<li>To re-introduce the stale credentials fault, again change the IAM role for the EC2 instance in us-east-2c to <strong>WebApp1-EC2-noDDB-Role-HealthCheckLab</strong></li>
<li>See <a href="#change_role">3.2 Inject fault on one of the servers</a> if you need a reminder of how to do this.</li>
<li>Go to the <strong>Target Groups</strong> console click on the <strong>Targets</strong> tab and note the health status as per the ELB health checks (remember to refresh)</li>
<li>Note that the server in us-east-2c is now failing the health check with a http code 503 Service Not Available<ul>
<li>With an <strong>Interval</strong> of <em>15</em> seconds, and a <strong>Healthy threshold</strong> of <em>2</em>, it can take up to 30 seconds to see the status update.</li>
</ul>
</li>
<li>The ELB has identified the us-east-2c server as unhealthy and will not route traffic to it</li>
<li>
<p>This is known as <em>fail-closed</em> behavior</p>
<p><img alt="OneUnhealthy503" src="Images/OneUnhealthy503.png" /></p>
</li>
</ul>
</li>
<li>
<p>Refresh the web service multiple times and note it is however still functioning without error</p>
<ul>
<li>And unlike before it is no longer returning a static response - it only returns personalized recommendations</li>
<li>Note that only the servers in us-east-2a and us-east-2b are serving requests</li>
</ul>
<table>
<thead>
<tr>
<th align="center">Well-Architected for Reliability: Best practices</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>Monitor all components of the workload to detect failures</strong>: Continuously monitor the health of your workload so that you and your automated systems are aware of degradation or complete failure as soon as they occur.</td>
</tr>
<tr>
<td align="center"><strong>Failover to healthy resources</strong>: Ensure that if a resource failure occurs, that healthy resources can continue to serve requests.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th align="center">Well-Architected for Reliability: Health Checks</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">The load balancer will only route traffic to healthy application instances. The health check needs to be at the data plane/application layer indicating the capability of the application on the instance. This check should not be against the control plane. A health check URL for the web application will be present and configured for use by the load balancer</td>
</tr>
</tbody>
</table>
</li>
</ol>
<h5 id="repair-the-server">Repair the server</h5>
<ol>
<li>Navigate to the EC2 Instances console and select only the instance in us-east-2c</li>
<li>Click <strong>Action</strong> &gt; <strong>Instance State</strong> &gt; <strong>Terminate</strong></li>
<li>Click <strong>Yes, Terminate</strong><ul>
<li>The EC2 instance will shut down</li>
<li>Amazon EC2 Auto Scaling will recognize there are less then the three Desired Capacity and will start up a new EC2 instance</li>
<li>The new instance replaces the one with the stale credentials fault, and loads fresh credentials</li>
</ul>
</li>
<li>From the <strong>Target Groups</strong> console <strong>Targets</strong> tab note the health check status of the new server in us-east-2c<ul>
<li>The new instance in us-east-2c will first show <strong>Description</strong> <em>Target registration is in progress</em></li>
<li>Then <strong>Description</strong> is <em>This target is currently passing target group's health checks</em>, then you may continue the workshop</li>
<li>(The <strong>Description</strong> may show <em>Health checks failed with these codes: [502]</em>, before getting to a healthy state. This is expected as the server initializes)</li>
<li>From the time you terminate the EC2 instance, it will take four to five minutes to get the new EC2 instance up and in a healthy state</li>
</ul>
</li>
<li>Refresh the web service multiple times and note that personalized recommendations are once again being served from all three servers</li>
</ol>
<h2 id="4-fail-open-when-appropriate">4. Fail open when appropriate<a name="fail_open"></a></h2>
<h3 id="41-disable-recommendationservice-again">4.1 Disable RecommendationService again</h3>
<ol>
<li>Confirm the service is healthy<ul>
<li>Refresh the web service multiple times and note that personalized recommendations are being served from all three servers</li>
</ul>
</li>
<li>You will now simulate another complete failure of the <strong>RecommendationService</strong>. Every request will fail for every request on every server<ul>
<li>Return to the <strong>AWS Systems Manager</strong> &gt; <strong>Parameter Store</strong> on the AWS Management Console</li>
<li>Set the value of <strong>RecommendationServiceEnabled</strong> once again to <strong>false</strong> and <strong>Save changes</strong></li>
</ul>
</li>
</ol>
<p>What is the expected behavior? The previous time you simulated a complete failure of the <strong>RecommendationService</strong></p>
<ul>
<li>The web service failed with a http 502 error</li>
<li>Then you implemented error handling and the following were observed<ul>
<li>The service returned a static response (as per the error handling code)</li>
<li>Since the healthcheck code at that time was configured to only return http 200, it reported <em>healthy</em> status for all servers</li>
</ul>
</li>
</ul>
<p>Now, with the new deep health check in place...</p>
<ul>
<li>What status do you expect the elastic load balancer to report for the servers?</li>
<li>How will the AWS Elastic Load Balancer handle traffic routing to the servers?</li>
</ul>
<h3 id="42-observe-fail-open-behavior">4.2 Observe fail-open behavior</h3>
<ol>
<li>Refresh the web service multiple times<ul>
<li>Look at which servers (and Availability Zones) are serving requests</li>
<li>Note that the service does not fail</li>
<li>But as expected (without access to <strong>RecommendationServiceEnabled</strong>) it always serves static responses</li>
</ul>
</li>
<li>Refresh the health check URL multiple times<ul>
<li>The deep health detects that <strong>RecommendationServiceEnabled</strong> is not available and returns a failure code for all servers</li>
</ul>
</li>
<li>
<p>From the <strong>Target Groups</strong> console <strong>Targets</strong> tab note the health check status of all the servers (you may need ot refresh)</p>
<ul>
<li>They all report <em>unhealthy</em> with http code 503. This is the code the deep health check is configured to return when the dependency is not available</li>
<li>
<p>Note the message at the top of the tab (if you do not see a message, try refreshing the entire page using the <em>browser</em> refresh function)</p>
<p><img alt="AllUnhealthy503" src="Images/AllUnhealthy503.png" /></p>
<table>
<thead>
<tr>
<th align="center">The Amazon Builders' Library: Implementing health checks</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">When an individual server fails a health check, the load balancer stops sending it traffic. But when all servers fail health checks at the same time, the load balancer fails open, allowing traffic to all servers.</td>
</tr>
<tr>
<td align="center">When we rely on fail-open behavior, we make sure to test the failure modes of the dependency heath check.</td>
</tr>
</tbody>
</table>
</li>
</ul>
<p>A system set to <em>fail-open</em> does not shut down when failure conditions are present. Instead, the system remains “open” and operations continue. The AWS Application Load Balancer here exhibits this fail-open behavior and the service continues to serve requests sent to it by the load balancer.</p>
</li>
<li>
<p>Reset the value of <strong>RecommendationServiceEnabled</strong>  to <strong>true</strong> and observe that the service resumes serving personalized recommendations.</p>
<ul>
<li>The <strong>RecommendationServiceEnabled</strong> parameter was initially intended  to  simulate the failure of <strong>RecommendationService</strong> for this lab</li>
<li>But now that we have implemented <em>fail-open</em> behavior and <em>graceful degradation</em> we could use the <strong>RecommendationServiceEnabled</strong> parameter as an <em>emergency lever</em> to cuto-off traffic to <strong>RecommendationService</strong> if there was a serious problem with it.</li>
</ul>
<table>
<thead>
<tr>
<th align="center">Well-Architected for Reliability: Best practice</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>Implement emergency levers</strong>: These are rapid processes that may mitigate availability impact on your workload. They can be operated in the absence of a root cause. An ideal emergency lever reduces the cognitive burden on the resolvers to zero by providing fully deterministic activation and deactivation criteria. Example levers include blocking all robot traffic or serving a static response. Levers are often manual, but they can also be automated.</td>
</tr>
</tbody>
</table>
</li>
</ol>
<h2 id="5-tear-down-this-lab">5. Tear down this lab <a name="tear_down"></a></h2>
<p><strong>If you are attending an in-person workshop and were provided with an AWS account by the instructor</strong>:</p>
<ul>
<li>There is no need to tear down the lab. Feel free to continue exploring. Log out of your AWS account when done.</li>
</ul>
<p><strong>If you are using your own AWS account</strong>:</p>
<ul>
<li>You may leave these resources deployed for as long as you want. When you are ready to delete these resources, see the following instructions</li>
</ul>
<h3 id="remove-aws-cloudformation-provisioned-resources">Remove AWS CloudFormation provisioned resources</h3>
<h4 id="how-to-delete-an-aws-cloudformation-stack">How to delete an AWS CloudFormation stack</h4>
<p>If you are already familiar with how to delete an AWS CloudFormation stack, then skip to the next section: <strong>Delete workshop CloudFormation stacks</strong></p>
<ol>
<li>Go to the AWS CloudFormation console: <a href="https://console.aws.amazon.com/cloudformation">https://console.aws.amazon.com/cloudformation</a></li>
<li>Select the CloudFormation stack to delete and click <strong>Delete</strong></li>
<li>In the confirmation dialog, click <strong>Delete stack</strong></li>
<li>The <strong>Status</strong> changes to <em>DELETE_IN_PROGRESS</em></li>
<li>Click the refresh button to update and status will ultimately progress to <em>DELETE_COMPLETE</em></li>
<li>When complete, the stack will no longer be displayed. To see deleted stacks use the drop down next to the Filter text box.</li>
<li>To see progress during stack deletion<ul>
<li>Click the stack name</li>
<li>Select the Events column</li>
<li>Refresh to see new events</li>
</ul>
</li>
</ol>
<h4 id="delete-workshop-cloudformation-stacks">Delete workshop CloudFormation stacks</h4>
<ol>
<li>First delete the <strong>HealthCheckLab</strong> CloudFormation stack</li>
<li>Wait for the <strong>HealthCheckLab</strong> CloudFormation stack to complete (it will no longer be shown on the list of actice stacks)</li>
<li>Then delete the <strong>WebApp1-VPC</strong> CloudFormation stack</li>
</ol>
<h3 id="remove-cloudwatch-logs">Remove CloudWatch logs</h3>
<p>After deletion of the <strong>WebApp1-VPC</strong> CloudFormation stack is complete then delete the CloudWatch Logs:</p>
<ol>
<li>Open the CloudFormation console at <a href="https://console.aws.amazon.com/cloudwatch/">https://console.aws.amazon.com/cloudwatch/</a>.</li>
<li>Click <strong>Logs</strong> in the left navigation.</li>
<li>Click the radio button on the left of the <strong>WebApp1-VPC-VPCFlowLogGroup-\&lt;some unique ID></strong>.</li>
<li>Click the <strong>Actions Button</strong> then click <strong>Delete Log Group</strong>.</li>
<li>Verify the log group name then click <strong>Yes, Delete</strong>.</li>
</ol>
<hr />
<h2 id="references-useful-resources">References &amp; useful resources</h2>
<ul>
<li><a href="https://medium.com/@adhorn/patterns-for-resilient-architecture-part-3-16e8601c488e">Patterns for Resilient Architecture — Part 3</a></li>
<li>Amazon Builders' Library: <a href="https://aws.amazon.com/builders-library/implementing-health-checks/">Implementing health checks</a></li>
<li><a href="https://aws.amazon.com/architecture/well-architected/">Well-Architected Framework</a> (see the Reliability pillar)</li>
<li><a href="https://wa.aws.amazon.com/wat.pillar.reliability.en.html">Well-Architected best practices for reliability</a></li>
<li><a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/target-group-health-checks.html">Health Checks for Your Target Groups</a> (for your Application Load Balancer)</li>
</ul>
<hr />
<h2 id="license">License</h2>
<h3 id="documentation-license">Documentation License</h3>
<p>Licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Share Alike 4.0</a> license.</p>
<h3 id="code-license">Code License</h3>
<p>Licensed under the Apache 2.0 and MITnoAttr License.</p>
<p>Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.</p>
<p>Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance with the License. A copy of the License is located at</p>
<p><a href="https://aws.amazon.com/apache2.0/">https://aws.amazon.com/apache2.0/</a></p>
<p>or in the <a href="../../LICENSE-Apache">"license" file</a> accompanying this file. This file is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="README.html" title="Lab Overview" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Lab Overview
              </span>
            </div>
          </a>
        
        
          <a href="../200_Testing_for_Resiliency_of_EC2/README.html" title="Lab Overview" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Lab Overview
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>